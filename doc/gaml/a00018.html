<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>gaml-1.12: example-005-students.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">gaml-1.12
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">example-005-students.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00142.html">gaml.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;istream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Let us consider students applying to some university. The</span></div>
<div class="line"><span class="comment">// university gives a mark to each student, from the school report of</span></div>
<div class="line"><span class="comment">// high school last year.</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> Discipline {</div>
<div class="line">  Art,</div>
<div class="line">  Biology,</div>
<div class="line">  Chemistry,</div>
<div class="line">  ForeignLanguage,</div>
<div class="line">  Geography,</div>
<div class="line">  History,</div>
<div class="line">  Literature,</div>
<div class="line">  Mathematics,</div>
<div class="line">  Music,</div>
<div class="line">  Physics,</div>
<div class="line">  Sports</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#define NB_DISCPIPLINES 11</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">std::string toString(<span class="keywordtype">int</span> d) {</div>
<div class="line">  <span class="keywordflow">switch</span>((Discipline)d) {</div>
<div class="line">  <span class="keywordflow">case</span> Art:             <span class="keywordflow">return</span> <span class="stringliteral">&quot;Art&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> Biology:         <span class="keywordflow">return</span> <span class="stringliteral">&quot;Biology&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> Chemistry:       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Chemistry&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> ForeignLanguage: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Foreign Language&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> Geography:       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Geography&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> History:         <span class="keywordflow">return</span> <span class="stringliteral">&quot;History&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> Literature:      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Literature&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> Mathematics:     <span class="keywordflow">return</span> <span class="stringliteral">&quot;Mathematics&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> Music:           <span class="keywordflow">return</span> <span class="stringliteral">&quot;Music&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> Physics:         <span class="keywordflow">return</span> <span class="stringliteral">&quot;Physics&quot;</span>;</div>
<div class="line">  <span class="keywordflow">case</span> Sports:          <span class="keywordflow">return</span> <span class="stringliteral">&quot;Sports&quot;</span>;</div>
<div class="line">  <span class="keywordflow">default</span>:              <span class="keywordflow">return</span> <span class="stringliteral">&quot;???&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Marks are given in [0,1]</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span>                            Mark;</div>
<div class="line"><span class="keyword">typedef</span> std::array&lt;Mark, NB_DISCPIPLINES&gt; Report;</div>
<div class="line"></div>
<div class="line">std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, <span class="keyword">const</span> Report&amp; r) {</div>
<div class="line">  os &lt;&lt; <span class="stringliteral">&quot;[&quot;</span>; </div>
<div class="line">  os &lt;&lt; toString(0) &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; r[0];</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt; NB_DISCPIPLINES; ++i)</div>
<div class="line">    os &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; toString(i) &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; r[i];</div>
<div class="line">  os &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;</div>
<div class="line">  <span class="keywordflow">return</span> os;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// The university gives a mark according to the average of some of the</span></div>
<div class="line"><span class="comment">// school report mark. If one mark is below the pass mark, the global</span></div>
<div class="line"><span class="comment">// score is 0 (elimination). The noise models an extra modulation by a</span></div>
<div class="line"><span class="comment">// panel of university professors.</span></div>
<div class="line"><span class="preprocessor">#define PANEL_EVALUATION_NOISE .1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define PASS_MARK              .3</span></div>
<div class="line"><span class="preprocessor"></span>Mark university_mark(<span class="keyword">const</span> Report&amp; report) {</div>
<div class="line">  Mark mark;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(   report[Discipline::Biology    ] &lt; PASS_MARK</div>
<div class="line">        || report[Discipline::Chemistry  ] &lt; PASS_MARK</div>
<div class="line">        || report[Discipline::Mathematics] &lt; PASS_MARK</div>
<div class="line">        || report[Discipline::Physics    ] &lt; PASS_MARK)</div>
<div class="line">    mark = 0;</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    mark =   report[Discipline::Biology    ]</div>
<div class="line">      + report[Discipline::Chemistry  ]</div>
<div class="line">      + report[Discipline::Mathematics]</div>
<div class="line">      + report[Discipline::Physics    ];</div>
<div class="line">    mark /= 4.0;</div>
<div class="line">    mark += <a name="a0"></a><a class="code" href="a00183.html#a63a869d5b9fe61b984623e3ecd99a033">gaml::random::uniform</a>(-PANEL_EVALUATION_NOISE,</div>
<div class="line">                                  PANEL_EVALUATION_NOISE);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> std::max(std::min(mark, 1.), 0.);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Let us define supervised learning vocabulary.</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> Report                  Sample;</div>
<div class="line"><span class="keyword">typedef</span> Mark                    Label;</div>
<div class="line"><span class="keyword">typedef</span> std::pair&lt;Sample,Label&gt; Data;</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> Report&amp; report_of(<span class="keyword">const</span> Data&amp; d) {<span class="keywordflow">return</span> d.first;}</div>
<div class="line">Mark          mark_of  (<span class="keyword">const</span> Data&amp; d) {<span class="keywordflow">return</span> d.second;}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Let us define a predictor, for a generic input for which attribute</span></div>
<div class="line"><span class="comment">// values can be iterated. The predictor implements an average if all</span></div>
<div class="line"><span class="comment">// marks are above the pass mark. It returns 0 (elimination)</span></div>
<div class="line"><span class="comment">// otherwise.</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> INPUT&gt; <span class="keyword">class </span>Predictor {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">double</span> pass_mark;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">  <span class="keyword">typedef</span> INPUT input_type;</div>
<div class="line">  <span class="keyword">typedef</span> Mark  output_type;</div>
<div class="line"></div>
<div class="line">  Predictor(<span class="keywordtype">double</span> pm) : pass_mark(pm) {}</div>
<div class="line"></div>
<div class="line">  output_type operator()(<span class="keyword">const</span> input_type&amp; input)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordtype">double</span> mark = 0;</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> m : input) </div>
<div class="line">      <span class="keywordflow">if</span>(m &lt; pass_mark) <span class="keywordflow">return</span> 0;</div>
<div class="line">      <span class="keywordflow">else</span>              mark += m;</div>
<div class="line">    <span class="keywordflow">return</span> mark/(Mark)input.size();</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// This is a learner, adapted to a particular variable projection (the</span></div>
<div class="line"><span class="comment">// INPUT parameter).</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> INPUT&gt; <span class="keyword">class </span>Learner {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">typedef</span> Predictor&lt;INPUT&gt; predictor_type;</div>
<div class="line"></div>
<div class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> DataIterator, <span class="keyword">typename</span> InputOf, <span class="keyword">typename</span> OutputOf&gt;</div>
<div class="line">  predictor_type operator()(<span class="keyword">const</span> DataIterator&amp; begin, <span class="keyword">const</span> DataIterator&amp; end,</div>
<div class="line">                            <span class="keyword">const</span> InputOf&amp; inputOf, <span class="keyword">const</span> OutputOf&amp; outputOf)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordtype">double</span> min_pass_mark = 0;</div>
<div class="line">    <span class="keywordtype">double</span> max_pass_mark = 1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keyword">auto</span> student = begin; student != end; ++student) {</div>
<div class="line">      <span class="keyword">auto</span> score = outputOf(*student);</div>
<div class="line">      <span class="keyword">auto</span>&amp; marks = inputOf(*student);</div>
<div class="line">      <span class="keyword">auto</span> min = std::min_element(marks.begin(),marks.end());</div>
<div class="line">      <span class="keywordflow">if</span>(score == 0) min_pass_mark = std::max(*min,min_pass_mark);</div>
<div class="line">      <span class="keywordflow">else</span>           max_pass_mark = std::min(*min,max_pass_mark);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> predictor_type((min_pass_mark+max_pass_mark)*.5);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// This is the learner used in the variable selection process.</span></div>
<div class="line"><span class="keyword">struct </span>GenericLearner {</div>
<div class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Input&gt;</div>
<div class="line">  Learner&lt;Input&gt; make()<span class="keyword"> const </span>{<span class="keywordflow">return</span> Learner&lt;Input&gt;();}</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// This learner uses internally a variable selection, and produces a</span></div>
<div class="line"><span class="comment">// predictor. This predictor performs the computed projection and then</span></div>
<div class="line"><span class="comment">// the decision.</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>MetaLearner {</div>
<div class="line">  <span class="keyword">typedef</span> std::vector&lt;int&gt; indices_type;</div>
<div class="line">  <span class="keyword">typedef</span> <a name="_a1"></a><a class="code" href="a00141.html">gaml::wrapper_traits&lt;Sample, Label, indices_type::iterator, GenericLearner&gt;</a> traits;</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">typedef</span> <span class="keyword">typename</span> traits::wrapping_predictor_type predictor_type;</div>
<div class="line">  <span class="keywordtype">bool</span> verbosity;</div>
<div class="line"></div>
<div class="line">  MetaLearner() : verbosity(false) {}</div>
<div class="line">  MetaLearner(<span class="keyword">const</span> MetaLearner&amp; other) : verbosity(other.verbosity) {}</div>
<div class="line"></div>
<div class="line">  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> DataIterator, <span class="keyword">typename</span> InputOf, <span class="keyword">typename</span> OutputOf&gt;</div>
<div class="line">  predictor_type operator()(<span class="keyword">const</span> DataIterator&amp; begin, <span class="keyword">const</span> DataIterator&amp; end,</div>
<div class="line">                            <span class="keyword">const</span> InputOf&amp; input_of, <span class="keyword">const</span> OutputOf&amp; label_of)<span class="keyword"> const </span>{</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Let us apply a variable selection process.</span></div>
<div class="line">    GenericLearner generic_learner;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// We need a real risk estimator for evaluating the algorithms when variables are selected.</span></div>
<div class="line">    <span class="keyword">auto</span> real_risk_estimator = <a name="a2"></a><a class="code" href="a00184.html#adf7f5a2dee85281e5a0b604b588e9560">gaml::risk::cross_validation</a>(<a name="_a3"></a><a class="code" href="a00083.html" title="Quadratic loss.">gaml::loss::Quadratic&lt;double&gt;</a>(),</div>
<div class="line">                                                            <a name="a4"></a><a class="code" href="a00181.html#a5b2281c25f57d3fbf33b397453f425e7">gaml::partition::kfold</a>(10), <span class="keyword">false</span>);</div>
<div class="line">    <span class="comment">// Wrapping evaluator</span></div>
<div class="line">    <span class="keyword">auto</span> evaluator = <a name="a5"></a><a class="code" href="a00188.html#a2b141b9fc3d65e2dd23bc86b6759b857">gaml::varsel::make_wrapper_evaluator</a>(generic_learner, real_risk_estimator,</div>
<div class="line">                                                          begin, end, input_of, label_of);</div>
<div class="line">    <span class="comment">// Make the evaluator verbose.</span></div>
<div class="line">    <span class="keywordflow">if</span>(verbosity) evaluator.verbose();</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// The result of a search is a subset of variables with its risk.</span></div>
<div class="line">    std::vector&lt;int&gt; variable_subset;</div>
<div class="line">    <span class="keywordtype">double</span>           best_risk = <a name="a6"></a><a class="code" href="a00188.html#a406be0b466d45889075be091d165f0e8">gaml::varsel::SFFS</a>(evaluator, variable_subset, verbosity);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(verbosity) {</div>
<div class="line">      std::cout &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;Risk is : &quot;</span> &lt;&lt; best_risk &lt;&lt; <span class="stringliteral">&quot;, with the following variable selection:&quot;</span> &lt;&lt; std::endl</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot;  {&quot;</span>;</div>
<div class="line">      <span class="keywordflow">for</span>(<span class="keyword">auto</span> attr : variable_subset) std::cout &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; toString(attr);</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot; }&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Let us set up the predictor from the projection of the data.</span></div>
<div class="line">    <span class="keyword">auto</span> projection = <a name="a7"></a><a class="code" href="a00171.html#a1ddb76665b6c96d816346adde7067e5f">gaml::project</a>(begin, end, </div>
<div class="line">                                    variable_subset.begin(), variable_subset.end(), </div>
<div class="line">                                    input_of, label_of);</div>
<div class="line">    <span class="keywordflow">return</span> projection.teach(generic_learner); <span class="comment">// The predictor is computed here.</span></div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define CACHE_PAGE_SIZE  200</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define CACHE_NB_PAGES    10</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define DATA_FILE  &quot;reports.dat&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define INDEX_FILE &quot;reports.idx&quot;</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define NB_DATA_IN_DATAFILE 10000</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div>
<div class="line">  <span class="keywordflow">if</span>(argc != 2) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Usage : &quot;</span> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; generate  &lt;-- makes the data file.&quot;</span> &lt;&lt; std::endl</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;  &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; run       &lt;-- process the file. &quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">bool</span> generate_mode = std::string(argv[1]) == <span class="stringliteral">&quot;generate&quot;</span>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Let us build data parsers.</span></div>
<div class="line">  <span class="keyword">auto</span> parser = gaml::make_JSON_parser&lt;Data&gt;();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(generate_mode) {</div>
<div class="line">    std::random_device rd;</div>
<div class="line">    std::mt19937 gen(rd());</div>
<div class="line">    std::normal_distribution&lt;&gt; d(.6,.15);</div>
<div class="line"> </div>
<div class="line">    std::ofstream ofile(DATA_FILE);</div>
<div class="line">    <span class="keyword">auto</span> ostr = <a name="a8"></a><a class="code" href="a00171.html#a2addf6f6d613b40c6f598ed3d68bf12a">gaml::make_output_data_stream</a>(ofile, parser);</div>
<div class="line">    <span class="keyword">auto</span> out  = <a name="a9"></a><a class="code" href="a00171.html#a0b23f6891f675d9e85f308c75a3d69bf">gaml::make_output_iterator</a>(ostr);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Generating students in \&quot;&quot;</span> &lt;&lt;  DATA_FILE &lt;&lt; <span class="stringliteral">&quot;\&quot;...&quot;</span> &lt;&lt; std::flush;</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt; NB_DATA_IN_DATAFILE; ++i) {</div>
<div class="line">      Report r;</div>
<div class="line">      <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; mark : r) mark = std::max(std::min(d(gen),1.),0.);</div>
<div class="line">      *(out++) = Data(r,university_mark(r));</div>
<div class="line">    }</div>
<div class="line">    ofile.close();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot; Done.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Removing old index file.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::remove(INDEX_FILE);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Here, we do not know how the university mark is given, and we</span></div>
<div class="line">  <span class="comment">// will try to predict it from a student report.</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Let us use an indexed file as a learning dataset.</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Binding a dataset to file \&quot;&quot;</span> &lt;&lt; DATA_FILE &lt;&lt; <span class="stringliteral">&quot;\&quot;, using \&quot;&quot;</span> </div>
<div class="line">            &lt;&lt; INDEX_FILE &lt;&lt; <span class="stringliteral">&quot;\&quot; for indices...&quot;</span> &lt;&lt; std::flush;</div>
<div class="line">  <span class="keyword">auto</span> dataset = <a name="a10"></a><a class="code" href="a00171.html#a6f27ba60caebb3559f4ac81e2cc1e644">gaml::make_indexed_dataset</a>(parser, DATA_FILE, INDEX_FILE);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot; Done.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// In order to reduce the file accesses, let us implement a cache.</span></div>
<div class="line">  <span class="keyword">auto</span> cached_dataset = <a name="a11"></a><a class="code" href="a00171.html#a2613c3bae4a11e8a81a09db41dbfb67d">gaml::cache</a>(dataset.begin(),dataset.end(), CACHE_PAGE_SIZE, CACHE_NB_PAGES); </div>
<div class="line"></div>
<div class="line">  <span class="comment">// Let us use learn from the whole dataset.</span></div>
<div class="line">  MetaLearner <a name="a12"></a><a class="code" href="a00172.html#a94145476ec3c62d9314841ce88ad24e5">learner</a>;</div>
<div class="line">  learner.verbosity = <span class="keyword">true</span>;</div>
<div class="line">  <span class="keyword">auto</span> pred = <a class="code" href="a00172.html#a94145476ec3c62d9314841ce88ad24e5">learner</a>(cached_dataset.begin(), cached_dataset.end(), report_of, mark_of);</div>
<div class="line">  Report test_report;</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; mark : test_report) mark = <a class="code" href="a00183.html#a63a869d5b9fe61b984623e3ecd99a033">gaml::random::uniform</a>(0,1);</div>
<div class="line">  std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Report &quot;</span> &lt;&lt; test_report &lt;&lt; <span class="stringliteral">&quot; will be scored &quot;</span> &lt;&lt; pred(test_report) &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Let us cross-validate the variable selection algorithm</span></div>
<div class="line">  <span class="comment">// itself. Note that intricated cross-validations are</span></div>
<div class="line">  <span class="comment">// involved. Indeed, the wrapper evaluation uses a</span></div>
<div class="line">  <span class="comment">// cross-validation...</span></div>
<div class="line">  </div>
<div class="line">  <span class="keyword">auto</span> evaluator = <a class="code" href="a00184.html#adf7f5a2dee85281e5a0b604b588e9560">gaml::risk::cross_validation</a>(<a class="code" href="a00083.html" title="Quadratic loss.">gaml::loss::Quadratic&lt;double&gt;</a>(),</div>
<div class="line">                                                <a class="code" href="a00181.html#a5b2281c25f57d3fbf33b397453f425e7">gaml::partition::kfold</a>(10), <span class="keyword">true</span>);</div>
<div class="line">  learner.verbosity = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">double</span> risk = evaluator(learner, cached_dataset.begin(), cached_dataset.end(), report_of, mark_of);</div>
<div class="line">  std::cout &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;The estimated real risk of the meta-learning process is &quot;</span> &lt;&lt; risk &lt;&lt; std::endl</div>
<div class="line">            &lt;&lt; std::endl;</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
